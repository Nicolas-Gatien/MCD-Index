name: GitHub Actions Demo
run-name: ${{ github.actor }} is testing out GitHub Actions ðŸš€
on: [push]
jobs:
    build:
        runs-on: ubuntu-latest
        env:
            IMAGE_NAME: mcdi
            NAMESPACE: nicolas-gatien
            APP_TAG: ghcr.io/$NAMESPACE/$IMAGE_NAME
        steps:
            - name: Checkout Code
              uses: actions/checkout@v4
            - run: echo ${{ secrets.PAT }} | docker login ghcr.io -u ${{ secrets.USERNAME }} --password-stdin
            - run: docker build -t $APP_TAG .
            - run: docker push $APP_TAG:latest

    deploy:
        needs: build
        runs-on: ubuntu-latest
        steps:
            - name: Download Artifact
              uses: actions/download-artifact@v4
              with:
                name: mcd-index
                path: /tmp
            
            - name: Load Image
              run: |
                docker load --input /tmp/mcd-index.tar
                docker image ls -a


